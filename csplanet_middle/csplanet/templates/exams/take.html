{% extends "base.html" %} {% block title %}{{ session.exam.title }}{% endblock
%} {% block content %}
<div class="container my-5">
  <h2>{{ session.exam.title }}</h2>
  <div class="mb-3">Time Remaining: <span id="timer"></span></div>
  <form method="post" action="{% url 'exams:exam_submit' session.id %}">
    {% csrf_token %} {% for question in questions %}
    <div class="card mb-4">
      <div class="card-body">
        <h5>Question {{ forloop.counter }}</h5>
        <p>
          {{ question.objective.content|default:question.subjective.content }}
        </p>
        {% if question.objective %} {% for choice in
        question.objective.choices.all %}
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="{{ question.id }}-selected_choice"
            id="choice-{{ choice.id }}"
            value="{{ choice.id }}"
          />
          <label class="form-check-label" for="choice-{{ choice.id }}"
            >{{ choice.content }}</label
          >
        </div>
        {% endfor %} {% else %}
        <textarea
          name="{{ question.id }}-text_answer"
          class="form-control"
          rows="3"
        ></textarea>
        {% endif %}
      </div>
    </div>
    {% endfor %}
    <button type="submit" class="btn btn-success">Submit Answers</button>
  </form>
</div>
<script>
  let endTime = new Date("{{ expires_at|date:"Y/m/d H:i:s" }}");
  let timerElem = document.getElementById('timer');
  function updateTimer() {
    let now = new Date();
    let diff = endTime - now;
    if (diff <= 0) {
      timerElem.textContent = '00:00';
      document.forms[0].submit();
    } else {
      let m = Math.floor(diff/60000).toString().padStart(2,'0');
      let s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
      timerElem.textContent = `${m}:${s}`;
      setTimeout(updateTimer, 1000);
    }
  }
  updateTimer();
</script>
